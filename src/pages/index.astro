---
import Layout from "../layouts/Layout.astro";
import Header from "../components/Header.svelte";
import SocialIcons from "../components/SocialIcons.astro";
import ProjectList from "../components/ProjectList.svelte";
import CabinLogo from "../assets/icons/cabin.png";
import CabinHouse from "../assets/icons/cabin_house.svg";
import work from "../data/work.yaml";
import { CATEGORIES } from "../utils/categoryUtils";
---

<Layout>
    <main class="main-content">
        <Header
            client:load
            siteTitle="dylan edwards"
            categories={Object.keys(CATEGORIES)}
            categoryMap={CATEGORIES}
            selectedCategory="some"
            currentPage="home"
        />
        <SocialIcons />
    </main>

    <div class="content-wrapper">
        <ProjectList
            client:load
            projects={work}
            scrollTriggerOffset={45}
            thumbnailHeight="60vh"
        />

        <footer class="logo-section">
            <a
                href="https://cabinedit.com"
                target="_blank"
                rel="noopener noreferrer"
                aria-label="Visit Cabin Edit"
                class="logo-link hover-opacity"
            >
                <div class="logo-container">
                    <img
                        src={CabinLogo.src}
                        alt="Cabin Edit Logo"
                        class="logo logo-png"
                        width="100"
                        height="100"
                        loading="lazy"
                    />
                    <img
                        src={CabinHouse.src}
                        alt="Cabin Edit Logo"
                        class="logo logo-svg"
                        width="100"
                        height="100"
                        loading="lazy"
                    />
                </div>
            </a>
        </footer>
    </div>
</Layout>

<script define:vars={{ work }}>
    // Make work data available globally
    window.work = work;
</script>

<script>
    window.handleCategoryChange = function (category) {
        // Notify about category change
        document.dispatchEvent(
            new CustomEvent("categoryChanged", {
                detail: { category },
            }),
        );

        // Filter projects
        const allProjects = window.work;
        let filteredProjects;

        if (category === "all") {
            filteredProjects = allProjects;
        } else {
            filteredProjects = allProjects.filter((project) => {
                const projectCategories =
                    project.categories?.toLowerCase().split(" ") || [];
                if (category === "some") {
                    return projectCategories.some((cat) => cat === "some");
                }
                return (
                    projectCategories.includes(category) ||
                    projectCategories.includes(`some ${category}`)
                );
            });
        }

        // Notify about filtered projects
        document.dispatchEvent(
            new CustomEvent("projectsFiltered", {
                detail: { projects: filteredProjects },
            }),
        );
    };
</script>

<style lang="scss">
    @import "../styles/variables";

    .content {
        &-wrapper {
            position: relative;
            z-index: map-get($z-index, base);
        }
    }

    .logo {
        &-section {
            position: relative;
            z-index: map-get($z-index, content);
            min-height: 100vh;
            width: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        &-link {
            @include focus-visible-outer;

            transition: opacity map-get($logo, transition-duration) ease;
        }

        &-container {
            position: relative;
            width: map-get($logo, desktop-size);
            height: map-get($logo, desktop-size);

            @media (max-width: map-get($breakpoints, mobile)) {
                width: map-get($logo, mobile-size);
                height: map-get($logo, mobile-size);
            }
        }

        width: 100%;
        height: 100%;
        object-fit: contain;

        &-png {
            position: absolute;
            top: 0;
            left: 0;
            opacity: 1;
            transition: opacity 0.3s ease;
        }

        &-svg {
            position: absolute;
            top: -8%;
            left: 0;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
    }

    // Ensure SVG stays white on dark background
    :global(.logo-svg) {
        filter: none;
    }

    .logo-link:hover {
        opacity: 1;
        .logo-png {
            opacity: 0;
        }

        .logo-svg {
            fill-opacity: 1;
            opacity: 1;
        }
    }

    // Optional: Add styles for main content
    .main-content {
        position: relative;
        z-index: map-get($z-index, content);
    }
</style>
